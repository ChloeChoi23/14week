<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>기억으로 깨어나는 습지</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  @font-face {
    font-family: 'Shilla';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2206-02@1.0/Shilla_CultureB-Bold.woff2') format('woff2');
    font-weight: 700;
    font-display: swap;
  }

  *{margin:0;padding:0;box-sizing:border-box;}
  html,body{
    height:100%;
    overflow:hidden;
    background:#0c1913;
    font-family:'Noto Sans KR',sans-serif;
    color:#dfe8e3;
  }

  #bg{
    position:fixed; inset:0;
    z-index:0;
    pointer-events:none;
    background:
      linear-gradient(rgba(10,20,15,0.6),rgba(5,10,8,0.8)),
      url('wetland_subtle_fast.jpeg') center/cover no-repeat;
    filter:brightness(0.6) saturate(0.9);
    opacity:1;
    transition:opacity 2s ease, filter 3s ease, background 3s ease;
  }
  #bg.next{
    background:
      linear-gradient(rgba(5,8,6,0.3),rgba(0,0,0,0.6)),
      url('wetland_subtle_fast.gif') center/cover no-repeat;
    filter:brightness(0.9) contrast(1.05);
  }

  canvas{
    position:absolute; inset:0;
    z-index:1;
    width:100%; height:100%;
    display:block;
  }

  #statsIntro{
    position:absolute; inset:0;
    background:rgba(10,20,15,0.75);
    backdrop-filter:blur(5px);
    z-index:5;
    display:flex; flex-direction:column;
    justify-content:center; align-items:center;
    opacity:1;
    transition:opacity 1.6s ease;
  }
  #statsIntro.hide{opacity:0; pointer-events:none;}

  .stats-title{
    font-family:'Shilla';
    font-size:clamp(32px,4.5vw,64px);
    color:#ecfff3;
    margin-bottom:40px;
    opacity:0; transform:translateY(20px);
    transition:opacity 1s ease, transform 1.2s ease;
  }
  .stats-title.show{opacity:1; transform:translateY(0);}

  .stats-table{
    width:70%; max-width:650px;
    border-collapse:collapse;
    font-size:clamp(16px,1.6vw,20px);
    opacity:0; transform:translateY(20px);
    transition:opacity 1.2s ease, transform 1.2s ease;
  }
  .stats-table.show{opacity:1; transform:translateY(0);}
  .stats-table tr{border-bottom:1px solid rgba(255,255,255,0.12);}
  .stats-table td{padding:16px 10px;}
  .value{text-align:right; font-weight:600; color:#c7ffe0;}

  .counter{opacity:0; transition:opacity .35s ease;}
  .counter.show{opacity:1;}
  .counter.red{color:#ff3a3a!important;}

  @keyframes dropIn {
    0%{transform:translateY(-60px);opacity:0;}
    60%{transform:translateY(0);opacity:1;}
    75%{transform:translateY(-12px);}
    100%{transform:translateY(0);}
  }
  .counter.drop{animation:dropIn .85s ease-out forwards;}

  #alertFlash{
    position:fixed; inset:0;
    background:rgba(255,0,0,0.65);
    z-index:6;
    opacity:0; transition:opacity .4s ease;
    pointer-events:none;
  }
  #alertFlash.show{opacity:1;}

  .center-text{
    position:absolute; top:50%; left:50%;
    transform:translate(-50%,-50%);
    width:90%; text-align:center;
    opacity:0; transition:opacity 1.8s ease;
    z-index:3;
  }
  .center-text.show{opacity:1;}

  .subtitle{
    position:absolute; top:-22vh; width:100%;
    font-size:clamp(16px,1.8vw,22px);
    white-space:pre-line;
    opacity:0; transform:translateY(12px);
    transition:opacity 1.3s ease, transform 1.3s ease;
  }
  .subtitle.show{opacity:1; transform:translateY(0);}

  .title{
    font-family:'Shilla';
    font-size:clamp(40px,6.3vw,82px);
    opacity:0; transition:opacity 1s ease;
  }
  .title.show{opacity:1;}

  .main-title{
    margin-top:3vh;
    font-family:'Shilla';
    font-size:clamp(72px,12vw,150px);
    color:rgba(255,255,255,0.65);
    opacity:0; transform:translateY(20px);
    transition:opacity 2.2s ease, transform 2.2s ease;
  }
  .main-title.show{opacity:1; transform:translateY(0);}

  .enter-btn{
    position:fixed; left:50%; bottom:6vh;
    transform:translateX(-50%);
    padding:0.8rem 2.4rem;
    font-family:'Shilla';
    font-size:1.1rem;
    color:#eaf5eb;
    background:rgba(255,255,255,0.1);
    border-radius:999px;
    border:none;
    cursor:pointer;
    opacity:0;
    transition:opacity 1.2s ease;
    z-index:5;
  }
  .enter-btn.show{opacity:1;}

  .fade-out{opacity:0!important; pointer-events:none!important;}

  .name{
    position:absolute; z-index:4;
    color:white; font-family:'Shilla';
    font-size:1.4rem;
    opacity:0;
    transform:translate(-50%,-50%) scale(0.8);
    transition:opacity .4s ease, transform 1.3s ease;
    pointer-events:none;
  }
  .name.show{opacity:1; transform:translate(-50%,-50%) scale(1.05);}

  .creature{
    position:fixed;
    z-index:2;
    opacity:0.35;
    filter:blur(1px) contrast(0.8);
    transition:opacity .8s ease, filter .8s ease, transform .8s ease;
    animation:floatSoft 12s ease-in-out infinite alternate;
    pointer-events:auto;
  }
  .creature.hide{
    opacity:0;
    filter:blur(4px) contrast(0.5);
  }
  .creature.gone{
    display:none;
  }
  .creature:hover{
    opacity:1;
    filter:blur(0) contrast(1);
  }

  @keyframes floatSoft{
    0%{transform:translate3d(0,0,0);}
    25%{transform:translate3d(20px,-15px,0);}
    50%{transform:translate3d(-18px,12px,0);}
    75%{transform:translate3d(15px,18px,0);}
    100%{transform:translate3d(-15px,-12px,0);}
  }

#creature1{ bottom:10%; left:40%;  width:13vw; animation-duration:15s; }
#creature2{ top:16%;  right:32%;   width:12vw; animation-duration:13s; }
#creature3{ top:58%;  right:6%;    width:26vw; animation-duration:14s; }
#creature4{ top:50%;  left:10%;    width:13vw; animation-duration:12s; }
#creature5{ top:28%;  left:7%;     width:19vw; animation-duration:16s; }
#creature6{ top:17%;  right:9%;    width:10vw; animation-duration:15s; }
#creature7{ bottom:30%; left:34%;  width:15vw; animation-duration:18s; }
#creature8{ top:24%;  right:20%;   width:16vw; animation-duration:17s; }
#creature9{ top:18%;  right:12%;   width:11vw;  animation-duration:14s; }
#creature10{bottom:18%; right:32%; width:14vw; animation-duration:12s; }
#creature11{bottom:42%; left:24%;  width:11vw; animation-duration:13s; }


  #mouseGuide{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    font-size:1.8rem;
    color:white;
    font-family:'Shilla';
    opacity:0;
    transition:opacity 1.5s ease;
    z-index:30;
  }
  #mouseGuide.show{opacity:1;}
  #mouseGuide.hide{opacity:0;}


  #infoBox{
    position:absolute;
    width:20vw;
    background:rgba(5,15,12,0.92);
    border:1px solid rgba(160,255,210,0.85);
    box-shadow:0 0 24px rgba(0,255,210,0.35);
    padding:18px 22px;
    display:none;
    color:#ccffdd;
    font-family:'Noto Sans KR',sans-serif;
    z-index:999999 !important;
  }
  #infoBox .box-title{
    font-family:'Shilla';
    font-size:1.4rem;
    margin-bottom:6px;
    letter-spacing:0.03em;
  }
  #infoBox .box-img{
    width:100%;
    margin:8px 0 10px;
    filter:contrast(1.05);
    display:block;
  }
  #infoBox .box-desc{
    font-size:0.8rem;
    line-height:1.5;white-space: pre-line;
  }
  .line{
  position:absolute;
  height:2px;
  background:rgba(255,50,50,0.8);
  transform-origin:left center;
  z-index:2000;
}

.point{
  position:absolute;
  width:14px; height:14px;
  background:#5df97a;
  border-radius:50%;
  border:2px solid #55ff77;
  z-index:5000;
}

.point-label{
  position:absolute;
  font-family:'Shilla';
  font-size:14px;
  color:#5df97a;
  transform:translate(-50%,-50%);
}
.infoBox-close{
  position:absolute;
  top:6px; right:10px;
  font-size:18px;
  cursor:pointer;
  color:#99ffcc;
}
.shape-overlay{
  position:fixed;
  display:none;
  pointer-events:none;
  z-index:3000;
  width:100%;
  height:100%;
  object-fit:contain;
}

.shape-overlay.show{
  display:block;
}



</style>
</head>

<body tabindex="-1">

<video id="bgm" src="forestsound.mp3" autoplay loop playsinline style="display:none"></video>

<div id="bg"></div>
<canvas id="ripples"></canvas>
<canvas id="lines"></canvas>
<div id="alertFlash"></div>
<div id="mouseGuide">마우스를 클릭해 생물들을 깨워주세요.</div>

<div id="statsIntro">
  <div class="stats-title" id="statsTitle">한국 습지, 사라지는 숫자들</div>
  <table class="stats-table" id="statsTable">
    <tr><td>내륙 습지 소실</td><td class="value"><span class="counter" data-val="176">0</span>곳</td></tr>
    <tr><td>연안 습지 감소</td><td class="value"><span class="counter" data-val="5.2">0</span>㎢</td></tr>
    <tr><td>습지보호지역</td><td class="value"><span class="counter" data-val="58">0</span>개소</td></tr>
    <tr><td>멸종위기 야생생물</td><td class="value"><span class="counter" data-val="282">0</span>종</td></tr>
  </table>
</div>

<div class="center-text" id="intro">
  <div class="subtitle" id="subtitle"></div>
  <div class="title" id="title"></div>
  <div class="main-title" id="mainTitle">화포천</div>
</div>

<img src="a.png" id="creature1" class="creature gone" alt="">
<img src="b.png" id="creature2" class="creature gone" alt="">
<img src="c.png" id="creature3" class="creature gone" alt="">
<img src="d.png" id="creature4" class="creature gone" alt="">
<img src="e.png" id="creature5" class="creature gone" alt="">
<img src="f.png" id="creature6" class="creature gone" alt="">
<img src="g.png" id="creature7" class="creature gone" alt="">
<img src="h.png" id="creature8" class="creature gone" alt="">
<img src="i.png" id="creature9" class="creature gone" alt="">
<img src="j.png" id="creature10" class="creature gone" alt="">
<img src="k.png" id="creature11" class="creature gone" alt="">
<!-- 오버레이 PNG -->
<img src="a1.png" id="overlay-creature1" class="shape-overlay">
<img src="b1.png" id="overlay-creature2" class="shape-overlay">
<img src="c1.png" id="overlay-creature3" class="shape-overlay">
<img src="d1.png" id="overlay-creature4" class="shape-overlay">
<img src="e1.png" id="overlay-creature5" class="shape-overlay">
<img src="f1.png" id="overlay-creature6" class="shape-overlay">
<img src="g1.png" id="overlay-creature7" class="shape-overlay">
<img src="h1.png" id="overlay-creature8" class="shape-overlay">
<img src="i1.png" id="overlay-creature9" class="shape-overlay">
<img src="j1.png" id="overlay-creature10" class="shape-overlay">
<img src="k1.png" id="overlay-creature11" class="shape-overlay">

<button id="enterBtn" class="enter-btn">ENTER</button>

<div id="infoBox">
  <div class="infoBox-close">×</div>
  <div class="box-title"></div>
  <img class="box-img" alt="">
  <div class="box-desc"></div>
</div>

<script>
const bgm=document.getElementById("bgm");
bgm.volume=0.05;
bgm.play().catch(()=>{
  const resume=()=>{
    bgm.play();
    document.removeEventListener("click",resume);
    document.removeEventListener("keydown",resume);
  };
  document.addEventListener("click",resume);
  document.addEventListener("keydown",resume);
});

function increaseVolume(){
  let v=0.05;
  const id=setInterval(()=>{
    v+=0.02;
    bgm.volume=v;
    if(v>=0.6) clearInterval(id);
  },150);
}
const creatures = Array.from(document.querySelectorAll('.creature'));
let awakenedCount = 0;
const totalCreatures = creatures.length;


const canvas=document.getElementById('ripples'),
      ctx=canvas.getContext('2d');
let W=canvas.width=innerWidth,
    H=canvas.height=innerHeight;
window.addEventListener('resize',()=>{
  W=canvas.width=innerWidth;
  H=canvas.height=innerHeight;
});

let ripples=[], allowNames=false;
document.addEventListener('mousemove', e=>{
ripples.push({x:e.clientX,y:e.clientY,radius:0,alpha:1,speed:3.2});
if(allowNames) createFloatingName(e.clientX,e.clientY);
});
function draw(){
  ctx.clearRect(0,0,W,H);
  ripples.forEach((r,i)=>{
    ctx.beginPath();
    ctx.arc(r.x,r.y,r.radius,0,Math.PI*2);
    ctx.strokeStyle=`rgba(200,255,225,${r.alpha*0.55})`;
    ctx.lineWidth=2;
    ctx.stroke();
    r.radius+=r.speed;
    r.alpha*=0.965;
    if(r.alpha<0.02) ripples.splice(i,1);
  });
  requestAnimationFrame(draw);
}
draw();

const species=[
  "수달","황새","가시연꽃","큰고니","삵","노랑부리저어새",
   "큰기러기","조롱이","참수리","귀이빨대칭이","수리부엉이","뜸부기"
];
let recentNames=[];
function createFloatingName(x,y){
  for(const p of recentNames){
    if(Math.hypot(x-p.x,y-p.y)<130) return;
  }
  recentNames.push({x,y});
  if(recentNames.length>6) recentNames.shift();

  const el=document.createElement("div");
  el.className="name";
  el.textContent=species[Math.floor(Math.random()*species.length)];
  el.style.left=x+"px";
  el.style.top=y+"px";
  document.body.appendChild(el);

  requestAnimationFrame(()=>el.classList.add("show"));

  const dx=(Math.random()-0.5)*90,
        dy=(Math.random()-0.5)*90;

  el.animate(
    [
      {opacity:1,transform:"translate(-50%,-50%) scale(1)"},
      {opacity:0,transform:`translate(${dx}px,${dy}px) scale(1.15)`}
    ],
    {duration:4000,easing:"ease-out"}
  );
  setTimeout(()=>el.remove(),4000);
}

function scheduleCreatureFade(){
  creatures.forEach((el,index)=>{
    setInterval(()=>{
      el.classList.toggle('hide');
    },3000 + index*400);
  });
}

function startStatsIntro(){
  const statsIntro=document.getElementById('statsIntro');
  const statsTitle=document.getElementById('statsTitle');
  const statsTable=document.getElementById('statsTable');
  const counters=document.querySelectorAll('.counter');

  setTimeout(()=>statsTitle.classList.add('show'),700);
  setTimeout(()=>statsTable.classList.add('show'),1800);

  setTimeout(()=>{
    counters.forEach((el,i)=>{
      setTimeout(()=>{
        el.classList.add('show');
        animateCounter(el);
      },i*600);
    });
  },2400);

  setTimeout(()=>{
    statsIntro.classList.add('hide');
    triggerFlashAndIntro();
  },9000);
}

function animateCounter(el){
  const target=parseFloat(el.dataset.val);
  let current=0;
  const step=target/55;
  const id=setInterval(()=>{
    current+=step;
    if(current>=target){
      current=target;
      clearInterval(id);
      setTimeout(()=>el.classList.add('drop'),150);
      setTimeout(()=>el.classList.add('red'),400);
    }
    el.textContent=(target%1===0)?Math.floor(current):current.toFixed(1);
  },35);
}

function triggerFlashAndIntro(){
  const flash=document.getElementById('alertFlash');
  let count = 0;

  const flashLoop = setInterval(()=>{
    flash.classList.toggle('show');
    count++;

    if(count >= 10){
      clearInterval(flashLoop);
      flash.classList.remove('show');
      startMainIntro();
    }
  },120);
}

function startMainIntro(){
  const intro     = document.getElementById('intro');
  const subtitle  = document.getElementById('subtitle');
  const titleEl   = document.getElementById('title');
  const mainTitle = document.getElementById('mainTitle');
  const enterBtn  = document.getElementById('enterBtn');

  intro.classList.add('show');

  const warning = "지금 이 순간에도\n한 곳의 습지가 또 사라졌습니다.\n그리고… 이곳 또한 언제 사라질지는 모릅니다.";
  let i = 0;

  (function typeWarning(){
    subtitle.classList.add('show');
    if(i < warning.length){
      subtitle.textContent += warning[i++];
      setTimeout(typeWarning,70);
    }else{
      startTitle();
    }
  })();

  function startTitle(){
    const t = "기억으로 깨어나는 습지,";
    let j = 0;

    (function typeT(){
      titleEl.classList.add('show');
      if(j < t.length){
        titleEl.textContent += t[j++];
        setTimeout(typeT,120);
      }else{
        setTimeout(()=>{
          mainTitle.classList.add('show');
          allowNames = true;  
        },700);

        setTimeout(()=>enterBtn.classList.add('show'),2000);
      }
    })();
  }
}

  function goNext(){
  const bg=document.getElementById('bg');
  const intro=document.getElementById('intro');
  const btn=document.getElementById('enterBtn');

  intro.classList.add('fade-out');
  btn.classList.add('fade-out');

  creatures.forEach(el=>el.classList.remove('gone'));

  scheduleCreatureFade();
  increaseVolume();

  setTimeout(()=>bg.classList.add('next'),1500);
  const guide = document.getElementById("mouseGuide");
  guide.classList.add("show");

  setTimeout(()=>{
     guide.classList.add("hide");
  },5000);
  allowNames = false;

}

document.getElementById('enterBtn').addEventListener('click', goNext);
window.addEventListener('keydown', e=>{
  if(e.key==="Enter") goNext();
});

const info = {
  creature1:{
    name:"가시연꽃",
    desc:"* 연못에 자라는 한해살이 수생식물.\n* 잎과 꽃줄기에 가시.\n* 여름에 자주색 꽃.\n* 멸종위기 야생생물 II급\n* 분포: 한국 중남부, 중국, 일본"
  },
  creature2:{
    name:"뜸부기",
    desc:"* 논과 습지에 사는 여름철새\n* 짙은 깃털과 노란 부리\n* 멸종위기 야생생물 II급\n* 분포: 한반도·일본·동남아"
  },
  creature3:{
    name:"큰고니",
    desc:"* 겨울철새, 큰 백색 고니\n* 목을 곧게 세우고 헤엄침\n* 멸종위기 야생생물 II급\n* 분포: 시베리아–한국–일본"
  },
  creature4:{
    name:"삵",
    desc:"* 중형 맹수, 야행성\n* 설치류·조류 사냥\n* 멸종위기 야생생물 II급\n* 분포: 전국, 러시아·중국·시베리아"
  },
  creature5:{
    name:"노랑부리저어새",
    desc:"* 주걱모양 부리, 흰 몸\n* 겨울철새\n* 멸종위기 야생생물 II급\n* 분포: 서해안, 제주, 동아시아"
  },
  creature6:{
    name:"조롱이",
    desc:"* 작은 맹금류, 숲속 번식\n* 멸종위기 야생생물 II급\n* 분포: 전국"
  },
  creature7:{
    name:"수리부엉이",
    desc:"* 한국 최대 올빼미\n* 단독 생활·야행성\n* 멸종위기 야생생물 II급\n* 분포: 전국, 유라시아"
  },
  creature8:{
    name:"황새",
    desc:"* 큰 몸집의 흰색 겨울철새\n* 인공 증식으로 재도입\n* 멸종위기 야생생물 I급\n* 분포: 천수만, 순천만"
  },
  creature9:{
    name:"참수리",
    desc:"* 거대한 맹금류\n* 흰 꼬리+노란 부리 특징\n* 멸종위기 야생생물 I급\n* 분포: 동북아시아"
  },
  creature10:{
    name:"수달",
    desc:"* 하천·호수 서식 포유류\n* 물갈퀴가 있어 수영 특화\n* 멸종위기 야생생물 I급\n* 분포: 전국"
  },
  creature11:{
    name:"귀이빨대칭이",
    desc:"* 한국 최대 담수 패류\n* 진주층이 형성되는 조개\n* 멸종위기 야생생물 I급\n* 분포: 전국"
  }
};
const overlays = {
  creature1: document.getElementById("overlay-creature1"),
  creature2: document.getElementById("overlay-creature2"),
  creature3: document.getElementById("overlay-creature3"),
  creature4: document.getElementById("overlay-creature4"),
  creature5: document.getElementById("overlay-creature5"),
  creature6: document.getElementById("overlay-creature6"),
  creature7: document.getElementById("overlay-creature7"),
  creature8: document.getElementById("overlay-creature8"),
  creature9: document.getElementById("overlay-creature9"),
  creature10: document.getElementById("overlay-creature10"),
  creature11: document.getElementById("overlay-creature11"),
};

const infoBox   = document.getElementById("infoBox");
const boxTitle  = infoBox.querySelector(".box-title");
const boxImg    = infoBox.querySelector(".box-img");
const boxDesc   = infoBox.querySelector(".box-desc");

let prevBoxElement = null;
let lines = [];
let activePoints=[];

function showOverlay(creature){
  const overlay = overlays[creature.id];
  overlay.classList.add("show");

  const rect = creature.getBoundingClientRect();
  overlay.style.left = rect.left + "px";
  overlay.style.top = rect.top + "px";
  overlay.style.width = rect.width + "px";
  overlay.style.height = rect.height + "px";

  creature.classList.add("gone");
}

creatures.forEach(c=>{
  c.addEventListener("click",()=>{

        awakenedCount++;
        checkAllAwakened();


    const rect = c.getBoundingClientRect();
    const data = info[c.id];
    const overlay = overlays[c.id];
    c.classList.add("gone");
    const newBox = infoBox.cloneNode(true);
    newBox.style.display="block";
    document.body.appendChild(newBox); 
    newBox.querySelector(".box-title").textContent = data.name;
    newBox.querySelector(".box-img").src = c.src;
    newBox.querySelector(".box-desc").textContent = data.desc;


const bw = newBox.offsetWidth;
const bh = newBox.offsetHeight;

let left = rect.left;
let top = rect.top;

if (left + bw > window.innerWidth) {
  left = window.innerWidth - bw - 20;
}
if (top + bh > window.innerHeight) {
  top = window.innerHeight - bh - 20;
}
if (left < 0) left = 20;
if (top < 0) top = 20;

newBox.style.left = left + "px";
newBox.style.top = top + "px";


    newBox.querySelector(".infoBox-close").addEventListener("click",()=>{
      newBox.remove();

      overlay.classList.add("show");
      overlay.style.left = rect.left + "px";
      overlay.style.top = rect.top + "px";
      overlay.style.width = rect.width + "px";
      overlay.style.height = rect.height + "px";
    });

  });
});
function checkAllAwakened(){
  if(awakenedCount === totalCreatures){

    const bg = document.getElementById("bg");
    bg.style.background =
      "linear-gradient(rgba(5,8,6,0.3),rgba(0,0,0,0.6)), url('after.jpg') center/cover no-repeat";

    const bgm = document.getElementById("bgm");

    let v = bgm.volume;

    let fadeOut = setInterval(()=>{
      v -= 0.03;
      bgm.volume = Math.max(v,0);

      if(v <= 0){
        clearInterval(fadeOut);

        bgm.src = "after.webm";  // 여기에 webm 넣으면 됨
        bgm.load();
        bgm.play().catch(()=>{});

        let nv = 0;
        let fadeIn = setInterval(()=>{
          nv += 0.03;
          bgm.volume = nv;
          if(nv >= 0.6) clearInterval(fadeIn);
        },100);
      }
    },100);
  }
}



startStatsIntro();
</script>

</body>
</html>
